<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ€ç»´å¯¼å›¾-æ˜Ÿæ¢¦æ¸¸Xmy</title>
    <!-- æ·»åŠ ç§‘å¹»å­—ä½“ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="my-mindMap.css">
    <link rel="stylesheet" href="rainbow-color.css">
    <link rel="stylesheet" href="control-panel.css">
    <link rel="stylesheet" href="background.css">
    <link rel="stylesheet" href="blue-theme.css">
    <link rel="stylesheet" href="theme-selector.css">
    <!-- æ·»åŠ ç§‘å¹»ä¸»é¢˜æ ·å¼ -->
    <link rel="stylesheet" href="sci-fi-theme.css">
    <link rel="stylesheet" href="sci-fi-theme-selector.css">
    <!-- æ·»åŠ æ·±æµ·è“ä¸»é¢˜æ ·å¼ -->
    <link rel="stylesheet" href="deep-sea-blue-theme.css">
    <meta name="description" content="ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ã€è§†è§‰ä¼˜ç¾çš„äº¤äº’å¼æ€ç»´å¯¼å›¾å·¥å…·">
    <style>
        /* ç¡®ä¿bodyå¯ä»¥æ¥æ”¶æ‰€æœ‰äº‹ä»¶ */
        body {
            overflow: hidden;
            width: 100%;
            height: 100%;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            margin: 0;
            padding: 0;
            pointer-events: auto;
        }
        
        /* å¼ºåˆ¶è§†é¢‘å¡«æ»¡æ•´ä¸ªå±å¹• */
        #custom-background {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100vw;
            height: 100vh;
            z-index: -1;
            overflow: hidden;
        }
        
        #custom-background video {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate3d(-50%, -50%, 0) scale(1.05);
            min-width: 105vw;
            min-height: 105vh;
            width: 100vw;
            height: 100vh;
            object-fit: cover !important;
            will-change: transform, opacity;
        }
        
        /* éšè—è§†é¢‘æ§ä»¶ */
        video::-webkit-media-controls-enclosure,
        video::-webkit-media-controls-panel,
        video::-webkit-media-controls,
        video::-webkit-media-controls-overlay-enclosure,
        video::-webkit-media-controls-play-button,
        video::-webkit-media-controls-timeline,
        video::-webkit-media-controls-current-time-display,
        video::-webkit-media-controls-time-remaining-display,
        video::-webkit-media-controls-mute-button,
        video::-webkit-media-controls-toggle-closed-captions-button,
        video::-webkit-media-controls-volume-slider,
        video::-webkit-media-controls-fullscreen-button {
            display: none !important;
            opacity: 0 !important;
            pointer-events: none !important;
        }
    </style>
    <!-- å¼ºåˆ¶è®¾ç½®é»˜è®¤ä¸»é¢˜ä¸ºå½©è™¹ä¸»é¢˜ -->
    <script>
        // åœ¨é¡µé¢åŠ è½½å‰å°±è®¾ç½®é»˜è®¤ä¸»é¢˜
        localStorage.setItem('mindMapTheme', 'rainbow');
        // ç¦ç”¨è“è‰²ä¸»é¢˜
        localStorage.setItem('blueThemePrefs', JSON.stringify({
            enabled: false,
            variant: 'classic',
            crystalNodesEnabled: false
        }));
        // ç¦ç”¨æ·±æµ·è“ä¸»é¢˜
        localStorage.setItem('deepseaThemePreferences', JSON.stringify({
            enabled: false,
            variant: 'classic',
            bubblesEnabled: true,
            particlesEnabled: true
        }));
        // é»˜è®¤è§†é¢‘èƒŒæ™¯
        localStorage.setItem('backgroundType', 'video');
    </script>
    <!-- é¢„åŠ è½½è§†é¢‘ä»¥æé«˜æ’­æ”¾æµç•…æ€§ -->
    <link rel="preload" href="meteor-sky-line-4.mp4" as="video" type="video/mp4" />
</head>
<body class="rainbow-theme">
    <!-- è‡ªå®šä¹‰èƒŒæ™¯å®¹å™¨ -->
    <div id="custom-background" class="custom-background">
        <!-- é»˜è®¤åŠ è½½è§†é¢‘èƒŒæ™¯ -->
        <video id="defaultBackgroundVideo" autoplay loop muted playsinline 
            disablePictureInPicture controlsList="nodownload nofullscreen noremoteplayback" 
            style="width: 100vw; height: 100vh; object-fit: cover; will-change: transform; backface-visibility: hidden;" 
            poster="alone-star.jpg"
            preload="auto">
            <source src="meteor-sky-line-4.mp4" type="video/mp4">
            <!-- æ·»åŠ å¤‡ç”¨æ ¼å¼æé«˜å…¼å®¹æ€§ -->
            <source src="meteor-sky-line-4.webm" type="video/webm" onerror="this.remove()">
        </video>
    </div>
    
    <div class="mind-map-container">
        <div class="mind-map" id="mindMap"></div>
        
        <div class="control-panel">
            <div class="title">
                æ€ç»´å¯¼å›¾æ§åˆ¶ä¸­å¿ƒ
                <span id="minimizeBtn" class="minimize-btn" title="æœ€å°åŒ–æ§åˆ¶é¢æ¿"></span>
            </div>
            <div class="controls">
                <button id="resetBtn" title="é‡ç½®è§†å›¾"><i>â†º</i>é‡ç½®</button>
                <button id="zoomInBtn" title="æ”¾å¤§"><i>+</i>æ”¾å¤§</button>
                <button id="zoomOutBtn" title="ç¼©å°"><i>-</i>ç¼©å°</button>
                <button id="themeBtn" title="é€‰æ‹©ä¸»é¢˜æ ·å¼"><i>ğŸ¨</i>ä¸»é¢˜</button>
                <button id="autoLayoutBtn" title="è‡ªåŠ¨å¸ƒå±€"><i>âŸ²</i>è‡ªåŠ¨å¸ƒå±€</button>
                <button id="expandAllBtn" title="å±•å¼€æ‰€æœ‰èŠ‚ç‚¹"><i>âŠ</i>å±•å¼€å…¨éƒ¨</button>
                <button id="saveBtn" title="ä¿å­˜æ€ç»´å¯¼å›¾ä¸ºHTML (å¯å†æ¬¡ç¼–è¾‘)"><i>ğŸ’¾</i>ä¿å­˜</button>
                <button id="backgroundBtn" title="é€‰æ‹©è‡ªå®šä¹‰èƒŒæ™¯"><i>ğŸ–¼ï¸</i>è‡ªå®šä¹‰èƒŒæ™¯</button>
            </div>
            <div class="instructions">
                <p><b>æ“ä½œè¯´æ˜ï¼š</b></p>
                <p>å•å‡»å·¦é”®ï¼šé€‰ä¸­èŠ‚ç‚¹</p>
                <p>åŒå‡»å·¦é”®ï¼šç¼–è¾‘æ–‡æœ¬</p>
                <p>åŒå‡»å³é”®ï¼šæ·»åŠ å­èŠ‚ç‚¹</p>
                <p>é•¿æŒ‰å³é”®ï¼šéšè—/æ˜¾ç¤ºå­èŠ‚ç‚¹</p>
                <p>Deleteé”®ï¼šåˆ é™¤é€‰ä¸­èŠ‚ç‚¹</p>
                <p>Ctrl+æ»šè½®ï¼šç¼©æ”¾è§†å›¾</p>
                <p>Ctrl+Lï¼šè‡ªåŠ¨å¸ƒå±€æ‰€æœ‰èŠ‚ç‚¹</p>
                <p>Ctrl+Sï¼šä¿å­˜(å¯å†æ¬¡ç¼–è¾‘)</p>
            </div>
        </div>
        
    </div>

    <div class="tooltip" id="tooltip"></div>
    
    <!-- æ·»åŠ éšè—çš„æ–‡ä»¶è¾“å…¥å…ƒç´  -->
    <input type="file" id="backgroundFileInput" style="display: none;" accept="image/*,video/*">
    
    <!-- å…ˆåŠ è½½å½©è™¹ä¸»é¢˜è„šæœ¬ï¼Œç¡®ä¿ä¼˜å…ˆçº§ -->
    <script src="rainbow-color.js"></script>
    
    <!-- å¼•å…¥æ‹†åˆ†åçš„JSæ–‡ä»¶ -->
    <script src="mindmap-core.js"></script>
    <script src="mindmap-nodes.js"></script>
    <script src="mindmap-connectors.js"></script>
    <script src="mindmap-events.js"></script>
    <script src="mindmap-utils.js"></script>
    
    <!-- å…¶ä»–åŠŸèƒ½æ¨¡å— -->
    <script src="control-panel.js"></script>
    <script src="save.js"></script>
    <script src="background.js"></script>
    <!-- ä¸»é¢˜ç›¸å…³è„šæœ¬ -->
    <script src="blue-theme.js"></script>
    <script src="sci-fi-theme.js"></script>
    <script src="deep-sea-blue-theme.js"></script>
    <!-- æ·»åŠ ä¸»é¢˜é€‰æ‹©å™¨å¢å¼ºè„šæœ¬ -->
    <script src="theme-selector.js"></script>
    <script src="my-function.js"></script>
    
    <!-- è§†é¢‘æ— ç¼å¾ªç¯å¸§è¡¥å¿ä¼˜åŒ–è„šæœ¬ -->
    <script>
    // æ·»åŠ å»¶è¿Ÿåˆå§‹åŒ–ç¡®ä¿è§†é¢‘åŠ è½½å®Œæˆå¹¶å¹³æ»‘å¾ªç¯æ’­æ”¾
    window.addEventListener('load', () => {
        setTimeout(() => {
            const video = document.getElementById('defaultBackgroundVideo');
            if (video) {
                // ç¡®ä¿è§†é¢‘åœ¨å¾ªç¯æ—¶ä¸ä¼šå¡é¡¿
                video.addEventListener('timeupdate', () => {
                    // åœ¨è§†é¢‘æ¥è¿‘ç»“å°¾æ—¶æå‰é‡ç½®æ—¶é—´ç‚¹
                    const bufferTime = 0.2; // æå‰200æ¯«ç§’é‡ç½®
                    if(video.duration > 0 && video.currentTime > video.duration - bufferTime) {
                        // ä½¿ç”¨requestAnimationFrameç¡®ä¿ä¸æ˜¾ç¤ºå™¨åˆ·æ–°ç‡åŒæ­¥
                        requestAnimationFrame(() => {
                            video.currentTime = 0;
                        });
                    }
                });
            }
        }, 100);
    });
    </script>
    
    <!-- å¢å¼ºè§†é¢‘å¾ªç¯åŠŸèƒ½ -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // è·å–èƒŒæ™¯è§†é¢‘å…ƒç´ 
        const bgVideo = document.getElementById('defaultBackgroundVideo');
        
        if (bgVideo) {
            // è®¾ç½®å¤šé‡å¾ªç¯ä¿éšœæœºåˆ¶
            bgVideo.loop = true; // HTML5åŸç”Ÿå¾ªç¯
            
            // ç›‘å¬è§†é¢‘ç»“æŸäº‹ä»¶
            bgVideo.addEventListener('ended', function() {
                console.log('è§†é¢‘ç»“æŸï¼Œé‡æ–°æ’­æ”¾');
                bgVideo.currentTime = 0;
                bgVideo.play().catch(err => console.log('é‡æ–°æ’­æ”¾å¤±è´¥:', err));
            });
            
            // å½“é¡µé¢é‡æ–°è·å¾—ç„¦ç‚¹æ—¶ï¼Œæ£€æŸ¥è§†é¢‘æ˜¯å¦åœ¨æ’­æ”¾
            document.addEventListener('visibilitychange', function() {
                if (!document.hidden) {
                    if (bgVideo.paused) {
                        bgVideo.play().catch(err => {});
                    }
                }
            });
            
            // ä½¿ç”¨MutationObserverç›‘è§†è§†é¢‘å…ƒç´ çš„ç§»é™¤å’Œæ›¿æ¢
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'childList' && mutation.removedNodes.length > 0) {
                        // æ£€æŸ¥æ˜¯å¦æœ‰æ–°çš„è§†é¢‘å…ƒç´ æ·»åŠ 
                        const newVideo = document.querySelector('#custom-background video');
                        if (newVideo && newVideo !== bgVideo) {
                            // ä¸ºæ–°è§†é¢‘è®¾ç½®å¾ªç¯å±æ€§
                            newVideo.loop = true;
                            newVideo.addEventListener('ended', function() {
                                this.currentTime = 0;
                                this.play().catch(err => {});
                            });
                        }
                    }
                });
            });
            
            // ç›‘è§†èƒŒæ™¯å®¹å™¨çš„å­èŠ‚ç‚¹å˜åŒ–
            observer.observe(document.getElementById('custom-background'), {
                childList: true,
                subtree: true
            });
            
            // ç¡®ä¿è§†é¢‘èƒ½å¤Ÿè‡ªåŠ¨æ’­æ”¾
            bgVideo.play().catch(function(error) {
                console.log('è‡ªåŠ¨æ’­æ”¾å¤±è´¥:', error);
                
                // ç›‘å¬ç”¨æˆ·äº¤äº’ä»¥å¯åŠ¨æ’­æ”¾
                const playVideo = function() {
                    bgVideo.play().catch(err => {});
                    document.removeEventListener('click', playVideo);
                    document.removeEventListener('keydown', playVideo);
                    document.removeEventListener('touchstart', playVideo);
                };
                
                document.addEventListener('click', playVideo);
                document.addEventListener('keydown', playVideo);
                document.addEventListener('touchstart', playVideo);
            });
        }
    });
    </script>
</body>
</html>
